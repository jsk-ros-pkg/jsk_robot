<launch>
  <arg name="video_path" default="/tmp" />
  <arg name="head_camera_video_title" default="go_to_kitchen_head_camera.avi" />
  <arg name="object_detection_video_title" default="go_to_kitchen_object_detection.avi" />
  <arg name="rosbag_title" default="go_to_kitchen_rosbag.bag" />

  <node name="go_to_kitchen" pkg="roseus" type="roseus" required="true" output="screen"
        args="$(find jsk_fetch_startup)/euslisp/go-to-kitchen.l">
    <rosparam subst_value="true">
      mail_notification: true
      file_paths:
        - $(arg video_path)/$(arg head_camera_video_title)
        - $(arg video_path)/$(arg object_detection_video_title)
        - $(arg video_path)/$(arg rosbag_title)
      file_titles:
        - $(arg head_camera_video_title)
        - $(arg object_detection_video_title)
        - $(arg rosbag_title)
    </rosparam>
    <rosparam command="load" file="/etc/ros/jsk_data/jsk_fetch_startup/go_to_kitchen/address.yaml" />
  </node>

  <!-- launch rviz with throttle -->
  <include file="$(find jsk_fetch_startup)/launch/rviz_record.launch" />

  <!-- Use m5stack_ros -->
  <!-- See https://github.com/jsk-ros-pkg/jsk_3rdparty/pull/289 -->
  <node name="rosserial_m5stack" pkg="rosserial_python" type="serial_node.py">
    <rosparam>
      port: /dev/rfcomm0 <!-- See /var/lib/robot/rfcomm_devices.yaml -->
      baud: 115200
    </rosparam>
  </node>

  <node name="go_to_kitchen_head_camera_video_recorder" pkg="image_view" type="video_recorder">
    <remap from="image" to="/head_camera/rgb/throttled/image_rect_color" />
    <rosparam subst_value="true">
      filename: $(arg video_path)/$(arg head_camera_video_title)
      codec: XVID
      stamped_filename: false
      fps: 5.0
    </rosparam>
  </node>
  <node name="go_to_kitchen_object_detection_video_recorder" pkg="image_view" type="video_recorder">
    <remap from="image" to="/edgetpu_object_detector/output/image" />
    <rosparam subst_value="true">
      filename: $(arg video_path)/$(arg object_detection_video_title)
      codec: XVID
      stamped_filename: false
      fps: 15.0 
    </rosparam>
  </node>

  <node name="go_to_kitchen_rosbag_recorder" pkg="rosbag" type="record"
        args="-q -O $(arg video_path)/$(arg rosbag_title)
              /tf /joint_states /odom /odom_combined /cmd_vel" />
</launch>
