<launch>
  <arg name="machine" default="c2" />
  <arg name="launch_edgetpu_human_pose_estimator" default="true" />
  <arg name="launch_edgetpu_object_detector" default="true" />

  <arg name="input_image" default="/kinect_head/rgb/image_rect_color" />

  <include file="$(find pr2_machine)/$(env ROBOT).machine" />

  <!-- edgetpu human pose estimator -->
  <node if="$(arg launch_edgetpu_human_pose_estimator)"
        name="edgetpu_human_node_manager" pkg="coral_usb" type="edgetpu_node_manager.py"
        machine="$(arg machine)">
  </node>
  <rosparam subst_value="true">
    edgetpu_human_node_manager:
      nodes:
        - name: edgetpu_human_pose_estimator
          type: human_pose_estimator
      default: edgetpu_human_pose_estimator
    edgetpu_human_pose_estimator:
      input_topic: $(arg input_image)
      image_transport: raw
      device_id: 0
  </rosparam>

  <!-- edgetpu object detector -->
  <node if="$(arg launch_edgetpu_object_detector)"
        name="edgetpu_object_node_manager" pkg="coral_usb" type="edgetpu_node_manager.py"
        machine="$(arg machine)">
  </node>
  <rosparam subst_value="true">
    edgetpu_object_node_manager:
      nodes:
        - name: edgetpu_object_detector
          type: object_detector
      default: edgetpu_object_detector
    edgetpu_object_detector:
      input_topic: $(arg input_image)
      image_transport: raw
      device_id: 1
      model_file: /etc/ros/jsk_data/coral_usb/mobilenet_v2_ssd_73b2_kitchen_finetuning_20200528.tflite
      label_file: /etc/ros/jsk_data/coral_usb/73b2_kitchen_labels.txt
  </rosparam>

</launch>
