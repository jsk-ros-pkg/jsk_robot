<launch>
  <!-- for app_manager -->
  <arg name="use_app_master" default="true" doc="launch master if enabled"/>
  <arg name="app_master_address" default="localhost" doc="address for app_manager master"/>
  <arg name="app_master_port" default="11312" doc="port for app_manager master"/>
  <arg name="applist" default=""
       doc="dirpath where *.installed file is located"/>
  <arg name="use_applist" default="false"
       doc="specify directory for apps, otherwise searched by using export tag"/>

  <!-- for rosbridge_websocket -->
  <arg name="launch_websocket" default="true"
       doc="launch rosbridge_websocket if true"/>
  <arg name="websocket_port" default="9090"
       doc="port number for rosbridge_websocket server"/>

  <!-- for roswww -->
  <arg name="launch_roswww" default="true"
       doc="launch roswww server if true"/>
  <arg name="roswww_port" default="8000"
       doc="port number for roswww server"/>

  <arg name="remote" default="false"
       doc="set true with valid 'machine' argument"/>
  <arg name="respawn" default="true"/>
  <arg name="machine" default="localhost"/>

  <!--
  Even if you don't want to use machine tag, machine name still need to be set.
  If remote is false, machine named 'localhost' is added to be run on local machine.
  -->
  <machine unless="$(arg remote)" name="$(arg machine)" address="localhost"/>

  <group if="$(arg launch_websocket)">
    <node name="rosbridge_websocket" pkg="rosbridge_server" type="rosbridge_websocket"
          output="screen" machine="$(arg machine)">
      <rosparam subst_value="true">
        address: ""
        port: $(arg websocket_port)
        authenticate: false
        retry_startup_delay: 5
        delay_between_messages: 0
        max_message_size: None
        fragment_timeout: 600
      </rosparam>
    </node>
    <node name="rosapi" pkg="rosapi" type="rosapi_node"
          machine="$(arg machine)"/>
  </group>

  <node if="$(arg launch_roswww)"
        name="roswww" pkg="roswww" type="webserver.py"
        output="screen" machine="$(arg machine)"
        args="--name roswww --webpath www --cached true
              --port $(arg roswww_port) --start_port $(arg roswww_port) --end_port $(arg roswww_port)"/>

  <!--
  NOTE: Ensure the param '/robot/type' and '/robot/name' are defined when the nodes below are started.
  -->
  <include file="$(find app_manager)/launch/app_manager.launch">
    <arg name="master" value="$(arg use_app_master)"/>
    <arg name="master_address" value="$(arg app_master_address)"/>
    <arg name="master_port" value="$(arg app_master_port)"/>
    <arg name="use_applist" value="$(arg use_applist)"/>
    <arg name="applist" value="$(arg applist)"/>
    <arg name="respawn" value="$(arg respawn)"/>
  </include>

</launch>
